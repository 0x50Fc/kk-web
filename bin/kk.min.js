kk={};kk.extend=function(proto,object){var p={};if(typeof object=="object"){for(var key in object){p[key]={value:object[key],configurable:true}}}return Object.create(proto,p)};(function(){var KeyCallback=function(){this.priority=0};KeyCallback.prototype.run=function(object,changedKeys){var v;if(typeof this.evaluateScript=="function"){v=this.evaluateScript(object)}else if(this.keys!==undefined){v=Data.get(object,this.keys)}if(typeof this.fn=="function"){this.fn(v,changedKeys)}};var KeyObserver=function(){this.children={};this.cbs=[]};KeyObserver.prototype.add=function(keys,cb,index){if(index<keys.length){var key=keys[index];var ch=this.children[key];if(ch===undefined){ch=new KeyObserver;this.children[key]=ch}ch.add(keys,cb,index+1)}else{this.cbs.push(cb)}};KeyObserver.prototype.remove=function(keys,fn,index){if(fn===undefined){this.children={};this.cbs=[]}else if(index<keys.length){var key=keys[index];var ch=this.children[key];if(ch){ch.remove(keys,fn,index+1)}}else{var cbs=[];for(var i=0;i<this.cbs.length;i++){var cb=this.cbs[i];if(cb.fn!=fn){cbs.push(cb)}}this.cbs=cbs;for(var key in this.children){var ch=this.children[key];ch.remove(keys,cbs,index)}}};KeyObserver.prototype.change=function(keys,cbs,index){if(index===undefined){index=0}if(index<keys.length){var key=keys[index];var ch=this.children[key];if(ch){ch.change(keys,cbs,index+1)}for(var i=0;i<this.cbs.length;i++){var cb=this.cbs[i];if(cb.children){cbs.push(cb)}}}else{for(var key in this.children){var ch=this.children[key];ch.change(keys,cbs,index)}for(var i=0;i<this.cbs.length;i++){var cb=this.cbs[i];cbs.push(cb)}}};KeyObserver.prototype.changedKeys=function(object,keys){if(keys===undefined){return}if(typeof keys=="string"){keys=keys.split(".")}if(keys instanceof Array){var cbs=[];this.change(keys,cbs);cbs.sort(function(a,b){return a.priority-b.priority});for(var i=0;i<cbs.length;i++){var cb=cbs[i];cb.run(object,keys)}}};KeyObserver.prototype.on=function(object,keys,fn,children,priority){var onKeys=[];var cb=new KeyCallback;cb.fn=fn;cb.children=children||false;cb.priority=priority||0;if(typeof keys=="string"){cb.evaluateScript=eval("(function(object){ var _G = {}; try { with(object) { _G.ret = "+keys+"; } } catch(e) {  } return _G.ret; } )");var v=keys.replace(/(\\\')|(\\\")/g,"");v=v.replace(/(\'.*?\')|(\".*?\")/g,"");v=v.replace(/\".*?\"/g,"");v.replace(/[a-zA-Z_][0-9a-zA-Z\\._]*/g,function(name){if(name&&!name.startsWith("_")){onKeys.push(name.split("."))}})}else if(keys instanceof Array){cb.keys=keys;onKeys.push(keys)}else{return false}if(onKeys.length==0){var v;try{v=cb.evaluateScript(object)}catch(e){kk.log("[ERROR] "+e)}if(v!==undefined){fn(v)}}else{while(onKeys.length){this.add(onKeys.shift(),cb,0)}}};KeyObserver.prototype.off=function(keys,fn){this.remove(keys,fn,0)};var Data=function(object){this.object=object||{};this.keyObserver=new KeyObserver};Data.IObject=function(){};Data.IObject.prototype.get=function(key){return this[key]};Data.IObject.prototype.set=function(key,value){this[key]=value};Data.get=function(object,keys,index){if(keys===undefined){return object}if(typeof keys=="string"){keys=keys.split(".")}if(keys instanceof Array){if(index===undefined){index=0}if(index<keys.length){var key=keys[index];if(typeof object=="object"){if(object instanceof Data.IObject){return Data.get(object.get(key),keys,index+1)}return Data.get(object[key],keys,index+1)}}else{return object}}};Data.set=function(object,keys,value,index){if(keys===undefined){return}if(typeof object!="object"){return}if(typeof keys=="string"){keys=keys.split(".")}if(keys instanceof Array){if(index===undefined){index=0}if(index+1<keys.length){var key=keys[index];var v;if(object instanceof Data.IObject){v=object.get(key)}else{v=object[key]}if(v===undefined){v={};if(object instanceof Data.IObject){object.set(key,v)}else{object[key]=v}}Data.set(v,keys,value,index+1)}else if(index<keys.length){var key=keys[index];if(object instanceof Data.IObject){object.set(key,value)}else{object[key]=value}}}};Data.prototype.get=function(keys){return Data.get(this.object,keys)};Data.prototype.set=function(keys,value,changed){Data.set(this.object,keys,value);if(changed===undefined||changed===true){this.changedKeys(keys)}};Data.prototype.on=function(keys,fn,children,priority){this.keyObserver.on(this.object,keys,fn,children,priority)};Data.prototype.off=function(keys,fn){this.keyObserver.remove(keys,fn,0)};Data.prototype.changedKeys=function(keys){this.keyObserver.changedKeys(this.object,keys)};Data.prototype.setParent=function(parent){if(this.fnParent&&this.parent){this.parent.off([],this.fnParent);delete this.parent;delete this.fnParent}if(parent){this.parent=parent;var data=this;this.fnParent=function(value,keys){if(value!==undefined){data.set(keys,Data.get(value,keys))}};parent.on([],this.fnParent,true);for(var key in parent.object){this.object[key]=parent.object[key]}this.changedKeys([])}};Data.prototype.recycle=function(){if(this.fnParent&&this.parent){this.parent.off([],this.fnParent);delete this.parent;delete this.fnParent}};var DataReflect=function(data){this.data=data;this.keyObserver=new KeyObserver;this.updatting=false;var v=this;this.fn=function(value,changedKeys){v.keyObserver.changedKeys(v.data.object,changedKeys)};this.data.on([],this.fn,true)};DataReflect.prototype=kk.extend(Data.IObject.prototype,{get:function(keys){return this.data.get(keys)},set:function(keys,value,changed){this.data.set(keys,value,changed)},changedKeys:function(keys){this.data.changedKeys(keys)},on:function(keys,fn,children,priority){this.keyObserver.on(this.data.object,keys,fn,children,priority)},off:function(keys,fn){this.keyObserver.remove(keys,fn,0)},recycle:function(){this.data.off([],this.fn)}});kk.Data=Data;kk.DataReflect=DataReflect})();(function(kk){kk.Storage=function(name){this._name=name;this._object={};var v=window.localStorage.getItem(name);if(v){this._object=JSON.parse(v)}if(typeof this._object!="object"){this._object={}}};kk.Storage.globalStorage=new kk.Storage("__G");kk.Storage.prototype=kk.extend(kk.Data.IObject.prototype,{get:function(key){return this._object[key]},set:function(key,value){if(value===undefined){delete this._object[key]}else{this._object[key]=value}},save:function(){window.localStorage.setItem(this._name,JSON.stringify(this._object))}})})(kk);kk.date={format:function(d,fmt){if(!(d instanceof Date)){d=new Date(parseInt(d))}var o={"M+":d.getMonth()+1,"d+":d.getDate(),"h+":d.getHours(),"m+":d.getMinutes(),"s+":d.getSeconds(),"q+":Math.floor((d.getMonth()+3)/3),S:d.getMilliseconds()};fmt=fmt.replace(/(y+)/,d.getFullYear()+"");for(var k in o){var v=o[k]+"";if(v.length<2){v="0"+v}fmt=fmt.replace(new RegExp("("+k+")"),v)}return fmt}};kk.Event=function(){};kk.Event.prototype=kk.extend(Object.prototype,{});kk.EventEmitter=function(){this.events={}};kk.EventEmitter.prototype=kk.extend(Object.prototype,{on:function(name,fn){if(name&&fn){var fns=this.events[name];if(fns===undefined){fns=[];this.events[name]=fns}fns.push(fn)}},off:function(name,fn){if(name&&fn===undefined){delete this.events[name]}else if(name===undefined&&fn===undefined){this.events={}}else if(name){var fns=this.events[name];if(fns){var count=0;for(var i=0;i<fns.length;i++){var v=fns[i];if(fn==v){delete fns[i]}else if(v){count++}}if(count==0){delete this.events[name]}}}else{var rm=[];for(var name in this.events){var fns=this.events[name];var count=0;for(var i=0;i<fns.length;i++){var v=fns[i];if(fn==v){delete fns[i]}else if(v){count++}}if(count==0){rm.push(name)}}for(var i=0;i<rm.length;i++){delete this.events[rm[i]]}}},emit:function(name,event){if(name&&event){var fns=this.events[name];if(fns){var vs=fns.slice();for(var i=0;i<vs.length;i++){var fn=vs[i];if(fn){var args=[];for(var i=1;i<arguments.length;i++){args.push(arguments[i])}fn.apply(this,args)}}}}},hasEvent:function(name){return this.events[name]!==undefined}});(function(){var HttpTask=function(options){this.options=options};HttpTask.prototype=kk.extend(Object.prototype,{onload:function(data,err){if(!this.options){return}if(typeof this.options.onload){this.options.onload(data,err)}},onfail:function(err){if(!this.options){return}if(typeof this.options.onfail){this.options.onfail(err)}},cancel:function(){delete this.options}});kk.http={send:function(options){var task=new HttpTask(options);$.ajax({dataType:options.type||"json",type:options.method||"GET",url:options.url,data:options.data,error:function(e){task.onfail(e)},success:function(data){task.onload(data)}});return task}}})();kk.apps=[];kk.booleanValue=function(v,defaultValue){if(v===undefined){return defaultValue}if(v){if(v=="false"||v=="0"){return false}return true}return false};kk.Image=function(url,app,ver){this.image=new Image;this.loaded=false;this.scale=1;if(app!==undefined){var v=this;var fn=function(){v.loaded=true;var event=new kk.Event;event.image=v;app.emit("image",event)};this.image.onload=fn;this.image.onerror=fn}else{var i=this;this.image.onload=function(){i.loaded=true;if(typeof i.onload=="function"){i.onload()}};this.image.onerror=function(){i.loaded=true;if(typeof i.onerror=="function"){i.onerror()}}}if(ver!==undefined){this.image.src=url+"?v="+ver}else{this.image.src=url}};kk.Image.prototype=kk.extend(kk.EventEmitter.prototype,{getURL:function(){return this.image.src},width:function(){return this.image.width/this.scale},height:function(){return this.image.height/this.scale}});kk.Script=function(app,url,ver){var key="kk:"+url+"?v="+ver;try{if(window.localStorage){this.content=window.localStorage.getItem(key)}}catch(ex){}if(!this.content){var v=this;kk.http.send({method:"GET",type:"text",url:url+"?v="+ver,onload:function(data){v.content=data;v.loaded=true;try{if(window.localStorage){window.localStorage.setItem(key,data)}}catch(ex){}var event=new kk.Event;event.script=v;app.emit("script",event)},onfail:function(data){v.loaded=true;var event=new kk.Event;event.script=v;app.emit("script",event)}})}else{this.loaded=true}};kk.log=function(text){if(typeof text=="object"){text=JSON.stringify(text)}console.info("[KK] ["+kk.date.format(new Date,"yyyy-MM-dd hh:mm:ss")+"] "+text)};kk.Application=function(){kk.EventEmitter.apply(this);this.data=new kk.Data({device:{mobile:/[Mm]obile/i.test(navigator.userAgent),iPhone:/iPhone/i.test(navigator.userAgent),iPad:/iPad/i.test(navigator.userAgent),iPod:/iPod/i.test(navigator.userAgent),android:/[Aa]ndroid/i.test(navigator.userAgent),ios:/(iPhone)|(iPad)|(iPod)/i.test(navigator.userAgent),wx:/[MicroMessage]/i.test(navigator.userAgent),chrome:/[Chrome]/i.test(navigator.userAgent),firefox:/[Firefox]/i.test(navigator.userAgent),ie:/[Internet Explorer]/i.test(navigator.userAgent),safari:/[Safari]/i.test(navigator.userAgent)}});this.UnitPX=1;this.UnitRPX=undefined;this.UnitVW=1;this.UnitVH=1;this.images={};this.scripts={};this.pages=[];this.resizeId=false;this.modules={};this.windows={};this.autoId=0;this.config=undefined;this.orientation="auto";var app=this;this.data.on(["action","open"],function(data){app.onAction(data)})};kk.getApp=function(){var n=kk.apps.length;if(n>0){return kk.apps[n-1]}};kk.pushApp=function(app){kk.apps.push(app)};kk.popApp=function(){return kk.apps.pop()};kk.Application.prototype=kk.extend(kk.EventEmitter.prototype,{run:function(url,view,key,oninfo){var a=document.createElement("a");a.href=url;this.baseURL=a.href;if(key===undefined){var i=this.baseURL.indexOf("?");if(i>0){key=md5(this.baseURL.substr(0,i))}else{key=md5(this.baseURL)}}var i=this.baseURL.lastIndexOf("/");if(i>0){this.baseURL=this.baseURL.substr(0,i+1)}this.view=view?view:document.body;var width=this.view.clientWidth;var height=this.view.clientHeight;if(this.config===undefined||this.config.UnitRPX===undefined){this.UnitRPX=Math.min(width,height)/750}else{this.UnitRPX=this.config.UnitRPX}if(this.config!==undefined&&this.config.orientation!==undefined){this.orientation=this.config.orientation}this.UnitVH=height*.01;this.UnitVW=width*.01;var app=this;kk.http.send({method:"GET",url:url,onload:function(data){if(typeof oninfo=="function"){oninfo(data)}app.open(data,url,key)},onfail:function(e){var event=new kk.Event;event.errmsg=e+"";app.emit("error",event)}});(function(view,app){var w=view.width();var h=view.height();app.resizeId=setInterval(function(){if(view.width()!=w||view.height()!=h){w=view.width();h=view.height();app.resize(w,h)}},1e3/30)})($(this.view),this)},getScript:function(path){var v=this.scripts[path];if(v&&v.loaded){return v.content}},getImage:function(path){if(!path){return}if(path.startsWith("http://")||path.startsWith("https://")){return new kk.Image(path)}var i=path.lastIndexOf(".");var ext="";if(i>=0){ext=path.substr(i);path=path.substr(0,i)}var s=3;while(s>0){var name;if(s==1){name=path+ext}else{name=path+"@"+s+"x"+ext}var v=this.images[name];if(v&&v.loaded){return v}s--}},require:function(path){var m=this.modules[path];if(m===undefined){m={exports:{}};this.modules[path]=m;var v=this.getScript(path);if(v){var fn=eval("(function(module,exports,app,http,print){"+v+"})");if(typeof fn=="function"){fn(m,m.exports,this.data,kk.http,kk.log)}}}return m.exports},exec:function(path,librarys){var script=this.getScript(path);if(!script){return}if(!librarys){librarys={}}if(!librarys["app"]){librarys["app"]=this.data}if(!librarys["http"]){librarys["http"]=kk.http}if(!librarys["print"]){librarys["print"]=kk.log}var app=this;librarys["kk"]={platform:"web",require:function(path){if(path.startsWith("./")){path=path.substr(2)}return app.require(path)}};var args=[];var code=["(function("];for(var key in librarys){if(args.length!=0){code.push(",")}code.push(key);args.push(librarys[key])}code.push("){ ");code.push(script);code.push(" })");var fn=eval(code.join(""));kk.pushApp(this);fn.apply(null,args);kk.popApp()},main:function(){this.exec("main.js",{})},done:function(){var done=true;for(var key in this.scripts){var v=this.scripts[key];if(!v.loaded){done=false;break}}if(done){for(var key in this.images){var v=this.images[key];if(!v.loaded){done=false;break}}}if(done){var event=new kk.Event;event.app=this;this.emit("load",event);this.main()}},open:function(appInfo,url,key){this.data.set(["global"],kk.Storage.globalStorage);this.data.on(["global"],function(){kk.Storage.globalStorage.save()},true,1);if(key!==undefined){var storage=new kk.Storage("app_"+key);this.data.set(["storage"],storage);this.data.on(["storage"],function(){storage.save()},true,1)}var items=appInfo.res;if(items){for(var i=0;i<items.length;i++){var item=items[i];if(item.path&&item.ver){if(item.path.endsWith(".js")){var v=new kk.Script(this,this.baseURL+item.path,item.ver);this.scripts[item.path]=v}else if(item.path.endsWith(".jpg")||item.path.endsWith(".png")||item.path.endsWith(".gif")){var v=new kk.Image(this.baseURL+item.path,this,item.ver);item.path.replace(/@([2-9])x\./i,function(text,scale){v.scale=parseInt(scale)});this.images[item.path]=v}}}}this.done()},emit:function(name,event){kk.EventEmitter.prototype.emit.apply(this,arguments);if(name=="script"||name=="image"){this.done()}},createPage:function(action){if(action&&action.type=="window"){return new kk.Window(this)}return new kk.Page(this)},onAction:function(action){kk.log(JSON.stringify(action));var app=this;kk.pushApp(this);if(action.back){var vs=action.back.split("/");while(vs.length>0){var v=vs.pop();if(v==".."){var page=this.pages.pop();(function(page){app.post(function(){page.recycle()})})(page)}}}if(action.path){var page=this.createPage(action);if(action.type=="window"){page.open(action.path);page.element.set("z-index","100");this.openWindow(page)}else{page.open(action.path);page.element.set("z-index","0");this.openPage(page)}}else if(action.url){window.location=action.url}else if(action.scheme){window.location=action.scheme}kk.popApp()},recycle:function(){this.data.off([]);var v=this.getCurPage();if(v){v.recycle()}for(var id in this.windows){v=this.windows[id];v.recycle()}if(this.resizeId){clearInterval(this.resizeId);delete this.resizeId}},getCurPage:function(){if(this.pages.length>0){return this.pages[this.pages.length-1]}},openWindow:function(page,animated){var id=++this.autoId+"";this.windows[id]=page;var app=this;page.obtainView(this.view);page.data.on(["action","close"],function(data){if(data.afterDelay){kk.pushApp(app);page.recycle();delete app.windows[id];kk.popApp();setTimeout(function(){kk.pushApp(app);page.recycleView();kk.popApp()},data.afterDelay)}else{kk.pushApp(app);page.recycle();page.recycleView();delete app.windows[id];kk.popApp()}})},openPage:function(page,animated){var app=this;var v=this.getCurPage();if(v){app.post(function(){v.recycleView()})}if(this.pages.length>0&&page.leftButton){page.leftButton.set("hidden","false")}page.obtainView(this.view);this.pages.push(page);page.data.on(["action","close"],function(data){app.back(data&&data.animated)})},back:function(animated){if(this.pages.length==1){var event=new kk.Event;event.animated=animated;this.emit("close",event);return}var app=this;var v=this.pages.pop();if(v){v.recycle();app.post(function(){v.recycleView()})}var page=this.getCurPage();if(page){page.obtainView(this.view)}},resize:function(width,height){if(this.config===undefined||this.config.UnitRPX===undefined){this.UnitRPX=Math.min(width,height)/750}else{this.UnitRPX=this.config.UnitRPX}this.UnitVH=height*.01;this.UnitVW=width*.01;kk.pushApp(this);var v=this.getCurPage();if(v){v.resize(width,height)}for(var id in this.windows){var page=this.windows[id];page.resize(width,height)}kk.popApp()},post:function(fn){if(this._doneFuncs===undefined){this._doneFuncs=[]}this._doneFuncs.push(fn);if(this._donning){return}this._donning=true;var app=this;var fns=this._doneFuncs;setTimeout(function(){kk.pushApp(app);while(fns.length>0){var fn=fns.shift();if(typeof fn=="function"){fn()}}app._donning=false;kk.popApp()},0)}});kk.ElementEvent=function(element){kk.Event.call(this);this.cancelBubble=false;this.element=element};kk.ElementEvent.prototype=kk.extend(kk.Event.prototype,{});kk.Element=function(){kk.EventEmitter.call(this);this.attributes={};this.styles={};this.parent=null;this.prevSibling=null;this.nextSibling=null;this.firstChild=null;this.lastChild=null;this.depth=0;this.app=kk.getApp()};kk.Element.prototype=kk.extend(kk.EventEmitter.prototype,{append:function(element){if(!(element instanceof kk.Element)){return}element.remove();if(this.lastChild){this.lastChild.nextSibling=element;element.prevSibling=this.lastChild;this.lastChild=element;element.parent=this}else{this.firstChild=this.lastChild=element;element.parent=this}this.didAddChildren(element);return this},before:function(element){if(!(element instanceof kk.Element)){return}element.remove();if(this.prevSibling){this.prevSibling.nextSibling=element;element.prevSibling=this.prevSibling;element.nextSibling=this;element.parent=this.parent;this.prevSibling=element}else if(this.parent){element.nextSibling=this;element.parent=this.parent;this.prevSibling=element;this.parent.firstChild=element}if(this.parent){this.parent.didAddChildren(element)}return this},after:function(element){if(!(element instanceof kk.Element)){return}element.remove();if(this.nextSibling){this.nextSibling.prevSibling=element;element.nextSibling=this.nextSibling;element.prevSibling=this;element.parent=this.parent;this.nextSibling=element}else if(this.parent){element.prevSibling=this;element.parent=this.parent;this.nextSibling=element;this.parent.lastChild=element}if(this.parent){tihs.parent.didAddChildren(element)}return this},remove:function(){if(this.prevSibling){this.parent.willRemoveChildren(this);this.prevSibling.nextSibling=this.nextSibling;if(this.nextSibling){this.nextSibling.prevSibling=this.prevSibling}else{this.parent.lastChild=this.prevSibling}}else if(this.parent){this.parent.willRemoveChildren(this);this.parent.firstChild=this.nextSibling;if(this.nextSibling){this.nextSibling.prevSibling=null}else{this.parent.lastChild=null}}return this},appendTo:function(element){if(element){element.append(this)}return this},beforeTo:function(element){if(element){element.before(this)}return this},afterTo:function(element){if(element){element.after(this)}return this},willRemoveChildren:function(element){element.depth=0},didAddChildren:function(element){element.depth=this.depth+1},changedKeys:function(keys){for(var i=0;i<keys.length;i++){this.changedKey(keys[i])}},changedKey:function(key){},keys:function(){var hasKeys={status:true,"in-status":true};var keys=[];for(var key in this.attributes){if(!hasKeys[key]){keys.push(key);hasKeys[key]=true}}var s=this.status();var attrs=this.styles[s];if(attrs){for(var key in attrs){if(!hasKeys[key]){keys.push(key);hasKeys[key]=true}}}if(s!=""){attrs=this.styles[""];if(attrs){for(var key in attrs){if(!hasKeys[key]){keys.push(key);hasKeys[key]=true}}}}return keys},get:function(key){var v=this.attributes[key];if(v===undefined){var s=this.status();if(s===undefined){s=""}var attrs=this.styles[s];if(attrs){v=attrs[key]}if(v===undefined&&s!=""){attrs=this.styles[""];if(attrs){v=attrs[key]}}}return v},set:function(key,value){if(!key){return}if(value===undefined){delete this.attributes[key]}else{this.attributes[key]=value}if(key=="status"||key=="in-status"){var hasKeys={status:true,"in-status":true};var keys=[];var s=this.status();var attrs=this.styles[s];if(attrs){for(var key in attrs){if(!hasKeys[key]){keys.push(key);hasKeys[key]=true}}}if(s!=""){attrs=this.styles[""];if(attrs){for(var key in attrs){if(!hasKeys[key]){keys.push(key);hasKeys[key]=true}}}}this.changedKeys(keys);var e=this.firstChild;while(e){e.set("in-status",s);e=e.nextSibling}}else{this.changedKeys([key])}},setAttrs:function(attrs){if(!attrs){return}var keys=[];for(var key in attrs){this.attributes[key]=attrs[key];keys.push(key)}this.changedKeys(keys)},setStyle:function(attrs,status){if(!attrs){return}if(!status){status=""}var keys=[];var vs=this.styles[status];if(vs===undefined){this.styles[status]=attrs;for(var key in attrs){keys.push(key)}}else{for(var key in attrs){vs[key]=attrs[key];keys.push(key)}}this.changedKey(keys)},setCSSStyle:function(cssStyle,status){if(!cssStyle){return}var attrs={};cssStyle.replace(/([A-Za-z0-9\- ]*)\:([^\;\n\r]*)/g,function(text,key,value){attrs[key.trim()]=value.trim()});this.setStyle(attrs,status)},status:function(){var s=this.attributes["status"];if(s===undefined){s=this.attributes["in-status"]}return s||""},setStatus:function(status){this.set("status",status||"")},data:function(){var data={};for(var key in this.attributes){if(key.startsWith("data-")){var v=this.attributes[key];data[key.substr(5)]=v}}return data},emit:function(name,event){kk.EventEmitter.prototype.emit.apply(this,arguments);if(event instanceof kk.ElementEvent){if(!event.cancelBubble){var p=this.parent;if(p){p.emit(name,event)}}}},hasEventBubble:function(name){if(this.hasEvent(name)){return true}var p=this.parent;if(p){return p.hasEventBubble(name)}return false},recycle:function(){this.off();this.remove();var p=this.firstChild;while(p){var n=p.nextSibling;p.recycle();p=n}},toString:function(){var v=[];var name=this.get("#name");if(name===undefined){name="element"}v.push("\t".repeat(this.depth));v.push("<");v.push(name);for(var key in this.attributes){if(key.startsWith("#")){continue}v.push(" ");v.push(key);v.push("=");v.push(JSON.stringify(this.attributes[key]+""))}for(var key in this.styles){v.push(" ");v.push("style");if(key!=""){v.push(":");v.push(key)}v.push('="');var attrs=this.styles[key];for(var name in attrs){v.push(name);v.push(": ");v.push(attrs[name]+"");v.push("; ")}v.push('"')}v.push(">");var p=this.firstChild;if(p){v.push("\n");while(p){v.push(p.toString());v.push("\n");p=p.nextSibling}v.push("\t".repeat(this.depth))}else{v.push(this.get("#text")||"")}v.push("</");v.push(name);v.push(">");return v.join("")}});kk.Pixel=function(v){this.type=0;this.value=0;if(typeof v=="string"){this.set(v)}};kk.Pixel.UnitPX=1;kk.Pixel.UnitRPX=.5;kk.Pixel.UnitVW=1;kk.Pixel.UnitVH=1;kk.Pixel.TYPE_AUTO=0;kk.Pixel.TYPE_PERCENT=1;kk.Pixel.TYPE_PX=2;kk.Pixel.TYPE_RPX=3;kk.Pixel.TYPE_VW=4;kk.Pixel.TYPE_VH=5;kk.Pixel.AUTO=0x8000000000000000;kk.Pixel.is=function(value){if(value=="auto"){return true}return/^[\-\+0-9]*(px|rpx|vw|vh|\%)$/i.test(value)};kk.Pixel.valueOf=function(value,baseOf,defalutValue){var p=new kk.Pixel;p.set(value);return p.valueOf(baseOf,defalutValue)};kk.Pixel.prototype=kk.extend(Object.prototype,{valueOf:function(baseOf,defaultValue){var app=kk.getApp();switch(this.type){case kk.Pixel.TYPE_PERCENT:return this.value*baseOf*.01;case kk.Pixel.TYPE_PX:if(app){return this.value*app.UnitPX}return this.value*kk.Pixel.UnitPX;case kk.Pixel.TYPE_RPX:if(app){var v=this.value*app.UnitRPX;if(this.value==1){return Math.max(v,1)}return v}return this.value*kk.Pixel.UnitRPX;case kk.Pixel.TYPE_VW:if(app){return this.value*app.UnitVW}return this.value*kk.Pixel.UnitVW;case kk.Pixel.TYPE_VH:if(app){return this.value*app.UnitVH}return this.value*kk.Pixel.UnitVH}return defaultValue},set:function(value){if(typeof value=="string"){this.type=kk.Pixel.TYPE_AUTO;this.value=0;if(value.endsWith("rpx")){this.type=kk.Pixel.TYPE_RPX;this.value=parseFloat(value)||0}else if(value.endsWith("px")){this.type=kk.Pixel.TYPE_PX;this.value=parseFloat(value)||0}else if(value.endsWith("vw")){this.type=kk.Pixel.TYPE_VW;this.value=parseFloat(value)||0}else if(value.endsWith("vh")){this.type=kk.Pixel.TYPE_VH;this.value=parseFloat(value)||0}else if(value.endsWith("%")){this.type=kk.Pixel.TYPE_PERCENT;this.value=parseFloat(value)||0}else if(value!="auto"){this.type=kk.Pixel.TYPE_PX;this.value=parseFloat(value)||0}}else if(value instanceof kk.Pixel){this.type=value.type;this.value=value.value}else{this.type=kk.Pixel.TYPE_AUTO;this.value=0}},toString:function(){return this.valueOf(0,0)+"px"}});kk.Edge=function(){this.top=new kk.Pixel;this.right=new kk.Pixel;this.bottom=new kk.Pixel;this.left=new kk.Pixel};kk.Color={parse:function(value){if(/^\#[0-9a-fA-F]{3,6}$/i.test(value)){return value}else if(/^\#[0-9a-fA-F]{8,8}$/i.test(value)){var a=parseInt(value.substr(1,2),16);var r=parseInt(value.substr(3,2),16);var g=parseInt(value.substr(5,2),16);var b=parseInt(value.substr(7,2),16);return"rgba("+r+","+g+","+b+","+a/255+")"}return"inherit"}};kk.Transform={parse:function(value){if(typeof value=="string"){var vs=value.split(" ");var r=[];for(var i=0;i<vs.length;i++){var v=vs[i];if(v.startsWith("translate(")&&v.endsWith(")")){var vv=v.substr(10,v.length-11).split(",");var x=vv.length>0?kk.Pixel.valueOf(vv[0],0,0)+"px":"0px";var y=vv.length>1?kk.Pixel.valueOf(vv[1],0,0)+"px":"0px";r.push("translate("+x+","+y+")")}else if(v.startsWith("scale(")&&v.endsWith(")")){var vv=v.substr(6,v.length-7).split(",");var x=vv.length>0?parseFloat(vv[0])+"":"1";var y=vv.length>1?parseFloat(vv[1])+"":"1";r.push("scale("+x+","+y+")")}else if(v.startsWith("rotate(")&&v.endsWith(")")){var vv=v.substr(7,v.length-8).split(",");var a=vv.length>0?parseFloat(vv[0])+"":"0";r.push("rotate("+a+"deg)")}else if(v.startsWith("rotateX(")&&v.endsWith(")")){var vv=v.substr(8,v.length-9).split(",");var a=vv.length>0?parseFloat(vv[0])+"":"0";r.push("rotateX("+a+"deg)")}else if(v.startsWith("rotateY(")&&v.endsWith(")")){var vv=v.substr(8,v.length-9).split(",");var a=vv.length>0?parseFloat(vv[0])+"":"0";r.push("rotateY("+a+"deg)")}else if(v.startsWith("rotateZ(")&&v.endsWith(")")){var vv=v.substr(8,v.length-9).split(",");var a=vv.length>0?parseFloat(vv[0])+"":"0";r.push("rotateZ("+a+"deg)")}}return r.join(" ")}return""}};kk.Font={parse:function(value,view,lineSpacing){if(typeof value=="string"){var vs=value.split(" ");for(var i=0;i<vs.length;i++){var v=vs[i];view.style.fontWeight="normal";view.style.fontStyle="normal";if(kk.Pixel.is(v)){var size=kk.Pixel.valueOf(v,0,0);if(size>=12){view.style.fontSize=size+"px";view.style.lineHeight=size+(lineSpacing||0)+"px";view.style.transform=""}else{var scale=size/12;size=12;view.style.fontSize=size+"px";view.style.lineHeight=size+(lineSpacing||0)+"px";view.style.transform="scale("+scale+")"}}else if(v=="bold"){view.style.fontWeight="bold"}else if(v=="italic"){view.style.fontStyle="italic"}else{view.style.fontFamily=v}}}else if(lineSpacing!==undefined){view.style.lineHeight=parseFloat(view.style.fontSize)+(lineSpacing||0)+"px"}}};kk.Edge.prototype=kk.extend(Object.prototype,{set:function(value){if(typeof value=="string"){var vs=value.split(" ");if(vs.length>0){this.top.set(vs[0]);if(vs.length>1){this.right.set(vs[1]);if(vs.length>2){this.bottom.set(vs[2]);if(vs.length>3){this.left.set(vs[3])}else{this.left.set(this.right)}}else{this.bottom.set(this.top);this.left.set(this.right)}}else{this.right.set(this.top);this.bottom.set(this.top);this.left.set(this.top)}}}else{this.top.set("auto");this.left.set("auto");this.bottom.set("auto");this.right.set("auto")}},toString:function(){return[this.top.toString(),this.right.toString(),this.bottom.toString(),this.left.toString()].join(" ")}});kk.ViewElement=function(){kk.Element.apply(this,arguments);this.frame={x:0,y:0,width:0,height:0};this.contentSize={width:0,height:0};this.contentOffset={x:0,y:0};this.padding=new kk.Edge;this.margin=new kk.Edge;this.width=new kk.Pixel;this.minWidth=new kk.Pixel;this.maxWidth=new kk.Pixel;this.height=new kk.Pixel;this.minHeight=new kk.Pixel;this.maxHeight=new kk.Pixel;this.left=new kk.Pixel;this.top=new kk.Pixel;this.right=new kk.Pixel;this.bottom=new kk.Pixel;this.lineSpacing=new kk.Pixel;this.verticalAlign="top";this.position="none";this.view=null;this._layout=kk.ViewElement.RelativeLayout};kk.ViewElement.FixLayoutWidth=function(p,inSize,width){var min=p.minWidth.valueOf(inSize.width,0);var max=p.maxWidth.valueOf(inSize.width,kk.Pixel.AUTO);if(width<min){width=min}if(width>max){width=max}return width};kk.ViewElement.FixLayoutHeight=function(p,inSize,height){var min=p.minHeight.valueOf(inSize.height,0);var max=p.maxHeight.valueOf(inSize.height,kk.Pixel.AUTO);if(height<min){height=min}if(height>max){height=max}return height};kk.ViewElement.RelativeLayout=function(element){var size={width:element.frame.width,height:element.frame.height};var padding={left:element.padding.left.valueOf(size.width,0),top:element.padding.top.valueOf(size.width,0),right:element.padding.right.valueOf(size.width,0),bottom:element.padding.bottom.valueOf(size.width,0)};var inSize={width:size.width-padding.left-padding.right,height:size.height-padding.top-padding.bottom};var contentSize={width:0,height:0};var p=element.firstChild;while(p){if(p instanceof kk.ViewElement){var margin={left:p.margin.left.valueOf(size.width,0),top:p.margin.top.valueOf(size.width,0),right:p.margin.right.valueOf(size.width,0),bottom:p.margin.bottom.valueOf(size.width,0)};var width=p.width.valueOf(inSize.width-margin.left-margin.right,kk.Pixel.AUTO);var height=p.height.valueOf(inSize.height-margin.top-margin.bottom,kk.Pixel.AUTO);if(width!=kk.Pixel.AUTO){width=kk.ViewElement.FixLayoutWidth(p,inSize,width)}if(height!=kk.Pixel.AUTO){height=kk.ViewElement.FixLayoutHeight(p,inSize,height)}p.frame.width=width;p.frame.height=height;p.layoutChildren();if(width==kk.Pixel.AUTO){width=kk.ViewElement.FixLayoutWidth(p,inSize,p.contentSize.width);p.frame.width=width}if(height==kk.Pixel.AUTO){height=kk.ViewElement.FixLayoutHeight(p,inSize,p.contentSize.height);p.frame.height=height}var left=p.left.valueOf(inSize.width,kk.Pixel.AUTO);var right=p.right.valueOf(inSize.width,kk.Pixel.AUTO);var top=p.top.valueOf(inSize.height,kk.Pixel.AUTO);var bottom=p.bottom.valueOf(inSize.height,kk.Pixel.AUTO);if(left==kk.Pixel.AUTO){if(size.width==kk.Pixel.AUTO){left=padding.left+margin.left}else if(right==kk.Pixel.AUTO){left=padding.left+margin.left+(inSize.width-width-margin.left-margin.right)*.5}else{left=padding.left+(inSize.width-right-margin.right-width)}}else{left=padding.left+left+margin.left}if(top==kk.Pixel.AUTO){if(size.height==kk.Pixel.AUTO){top=padding.top+margin.top}else if(bottom==kk.Pixel.AUTO){top=padding.top+margin.top+(inSize.height-height-margin.top-margin.bottom)*.5}else{top=padding.top+(inSize.height-height-margin.bottom-bottom)}}else{top=padding.top+top+margin.top}p.frame.x=left;p.frame.y=top;if(left+padding.right+margin.right+width>contentSize.width){contentSize.width=left+padding.right+margin.right+width}if(top+padding.bottom+margin.bottom+height>contentSize.height){contentSize.height=top+padding.bottom+margin.bottom+height}p.didLayouted()}p=p.nextSibling}element.contentSize=contentSize;return contentSize};kk.ViewElement.LineLayout=function(elements,inSize,lineHeight){for(var i=0;i<elements.length;i++){var element=elements[i];if(element.verticalAlign=="bottom"){var mbottom=element.margin.bottom.valueOf(inSize.height,0);var mtop=element.margin.top.valueOf(inSize.height,0);element.frame.y=element.frame.y+(lineHeight-mtop-mbottom-element.frame.height)}else if(element.verticalAlign=="middle"){var mbottom=element.margin.bottom.valueOf(inSize.height,0);var mtop=element.margin.top.valueOf(inSize.height,0);element.frame.y=element.frame.y+(lineHeight-mtop-mbottom-element.frame.height)*.5}element.didLayouted()}};kk.ViewElement.FlexLayout=function(element,isAutoWarp){if(isAutoWarp===undefined){isAutoWarp=true}var size={width:element.frame.width,height:element.frame.height};var padding={left:element.padding.left.valueOf(size.width,0),top:element.padding.top.valueOf(size.width,0),right:element.padding.right.valueOf(size.width,0),bottom:element.padding.bottom.valueOf(size.width,0)};var inSize={width:size.width-padding.left-padding.right,height:size.height-padding.top-padding.bottom};var y=padding.top;var x=padding.left;var maxWidth=padding.left+padding.right;var lineHeight=0;var lines=[];var p=element.firstChild;while(p){if(p instanceof kk.ViewElement){if(p.isHidden()){p=p.nextSibling;continue}var margin={left:p.margin.left.valueOf(size.width,0),top:p.margin.top.valueOf(size.width,0),right:p.margin.right.valueOf(size.width,0),bottom:p.margin.bottom.valueOf(size.width,0)};var width=p.width.valueOf(inSize.width-margin.left-margin.right,kk.Pixel.AUTO);var height=p.height.valueOf(inSize.height-margin.top-margin.bottom,kk.Pixel.AUTO);p.frame.width=width;p.frame.height=height;p.layoutChildren();if(width==kk.Pixel.AUTO){width=p.contentSize.width}if(height==kk.Pixel.AUTO){height=p.contentSize.height}var min=p.minWidth.valueOf(inSize.width,0);var max=p.maxWidth.valueOf(inSize.width,kk.Pixel.AUTO);if(width<min){width=min}if(width>max){width=max}p.frame.width=width;min=p.minHeight.valueOf(inSize.height,0);max=p.maxHeight.valueOf(inSize.height,kk.Pixel.AUTO);if(height<min){height=min}if(height>max){height=max}p.frame.height=height;if(isAutoWarp&&x+margin.left+margin.right+padding.right+p.frame.width>size.width){if(lines.length>0){kk.ViewElement.LineLayout(lines,inSize,lineHeight);lines=[]}y+=lineHeight;lineHeight=0;x=padding.left}var left=x+margin.left;var top=y+margin.top;x+=width+margin.left+margin.right;if(lineHeight<height+margin.top+margin.bottom){lineHeight=height+margin.top+margin.bottom}p.frame.x=left;p.frame.y=top;if(left+padding.right+margin.right+width>maxWidth){maxWidth=left+padding.right+margin.right+width}lines.push(p)}p=p.nextSibling}if(lines.length>0){kk.ViewElement.LineLayout(lines,inSize,lineHeight)}element.contentSize={width:maxWidth,height:y+lineHeight+padding.bottom};return element.contentSize};kk.ViewElement.HorizontalLayout=function(element){return kk.ViewElement.FlexLayout(element,false)};kk.ViewElement.prototype=kk.extend(kk.Element.prototype,{changedKey:function(key){kk.Element.prototype.changedKey.apply(this,arguments);var v=this.get(key);switch(key){case"padding":this.padding.set(v);break;case"margin":this.margin.set(v);break;case"width":this.width.set(v);break;case"min-width":this.minWidth.set(v);break;case"max-width":this.maxWidth.set(v);break;case"height":this.height.set(v);break;case"min-height":this.minHeight.set(v);break;case"max-height":this.maxHeight.set(v);break;case"left":this.left.set(v);break;case"top":this.top.set(v);break;case"right":this.right.set(v);break;case"bottom":this.bottom.set(v);break;case"layout":this.setLayout(v);break;case"vertical-align":this.verticalAlign=v;break;case"position":this.position=v;break;case"line-spacing":this.lineSpacing.set(v);break;case"skin":this.setUpdateSkin();break}if(this.view){this.viewChangedKey(this.view,key,v)}},updateSkin:function(){this.updattingSkin=false;var skin=this.get("skin");var e=this.firstChild;while(e){if(e.get("#name")=="skin"&&e.get("name")==skin){break}e=e.nextSibling}if(e){var attrs=e.attributes;var vs={};for(var key in attrs){if(key=="name"||key.startsWith("#")){continue}vs[key]=attrs[key]}this.setAttrs(vs)}},setUpdateSkin:function(){if(this.updattingSkin){return}this.updattingSkin=true;var element=this;var app=this.app;app.post(function(){element.updateSkin()})},setLayout:function(layout){if(typeof layout=="string"){switch(layout){case"relative":this._layout=kk.ViewElement.RelativeLayout;break;case"flex":this._layout=kk.ViewElement.FlexLayout;break;case"horizontal":this._layout=kk.ViewElement.HorizontalLayout;break;default:this._layout=null;break}}else{this._layout=layout}},createView:function(){var e=document.createElement("div");e.setAttribute("class","kk-view");return e},setView:function(view){this.view=view},viewChangedKey:function(view,key,value){switch(key){case"background-color":view.style.backgroundColor=kk.Color.parse(value);break;case"border-width":view.style.borderWidth=kk.Pixel.valueOf(value,0,0)+"px";break;case"border-color":view.style.borderColor=kk.Color.parse(value);break;case"border-radius":view.style.borderRadius=kk.Pixel.valueOf(value,0,0)+"px";break;case"overflow":if(value=="hidden"){view.style.overflow="hidden"}else{view.style.overflow="inherit"}break;case"color":view.style.color=kk.Color.parse(value);break;case"background-image":this.setNeedUpdateBackgroundView();break;case"text-align":view.style.textAlign=value;break;case"hidden":view.style.display=value=="true"?"none":"inherit";break;case"opacity":this.setDidChangedKey(key);break;case"transform":this.setDidChangedKey(key);break;case"animation":this.setDidChangedKey(key);break;case"z-index":view.style.zIndex=parseInt(value);break}},didChangedKeys:function(){this.didChangedKeying=false;var view=this.view;if(!view){return}var attrs=this.didChangedKeys;delete this.didChangedKeys;if(attrs){var element=this;var setAttrs=function(){for(var key in attrs){if(key=="opacity"){view.style.opacity=parseFloat(element.get(key))}else if(key=="transform"){view.style.transform=kk.Transform.parse(element.get(key))}}};if(attrs["animation"]){var anim=element.get("animation");if(this._curAnimation!=anim){this._curAnimation=anim;if(anim){var e=this.firstChild;while(e){if(e instanceof kk.AnimationElement){if(e.get("name")==anim){break}}e=e.nextSibling}if(e){e.startAnimation(this,view,setAttrs);return}}}}setAttrs()}},setDidChangedKey:function(key){if(this.didChangedKeys===undefined){this.didChangedKeys={}}this.didChangedKeys[key]=true;var view=this.view;if(!view){return}if(this.didChangedKeying){return}this.didChangedKeying=true;var element=this;var app=this.app;app.post(function(){element.didChangedKeys()})},updateBackgroundView:function(){this._updateBackgroundView=false;if(this.frame.width<=0||this.frame.height<=0){return}var view=this.view;if(!view){return}var value=this.get("background-image");if(!value){return}var vs=(value||"").split(" ");if(vs.length>0&&vs[0]){var image=this.app.getImage(vs[0]);if(image&&vs.length>1){var img=document.createElement("img");img.src=image.getURL();var mCapLeft=(parseInt(vs[1])||0)*image.scale;var mCapTop=(parseInt(vs[2])||0)*image.scale;var mCapSize=1*image.scale;var v=1/image.scale;var canvas=document.createElement("canvas");var width=canvas.width=this.frame.width;var height=canvas.height=this.frame.height;var mWidth=img.width;var mHeight=img.height;var capSize=1;if(mCapLeft!=0&&mCapTop!=0){if(mWidth*v>=width){mCapLeft=0}if(mHeight*v>=height){mCapTop=0}}else if(mCapLeft!=0&&mCapTop==0){if(mWidth*v>=mWidth*xScale){mCapLeft=0}}else if(mCapLeft==0&&mCapTop!=0){if(mHeight*v>=mHeight*yScale){mCapTop=0}}var ctx=canvas.getContext("2d");if(mCapTop==0){var xScale=height/mHeight;var capLeft=mCapLeft*xScale;var capRight=width-(mWidth*xScale-capLeft-mCapSize);ctx.drawImage(img,0,0,mCapLeft,mHeight,0,0,capLeft,height);ctx.drawImage(img,mCapLeft,0,mCapSize,mHeight,capLeft,0,capRight-capLeft,height);ctx.drawImage(img,mCapLeft+mCapSize,0,mWidth-mCapLeft-mCapSize,mHeight,capRight,0,width-capRight,height)}else if(mCapLeft==0){var yScale=width/mWidth;var capTop=mCapTop*yScale;var capBottom=height-(mHeight*yScale-capTop-mCapSize);ctx.drawImage(img,0,0,mWidth,mCapTop,0,0,width,capTop);ctx.drawImage(img,0,mCapTop,mWidth,mCapSize,0,capTop,width,capBottom-capTop);ctx.drawImage(img,0,mCapTop+mCapSize,mWidth,mHeight-mCapTop-mCapSize,0,capBottom,width,height)}else{var capLeft=mCapLeft*v;var capRight=width-(mWidth-capLeft-capSize)*v;var capTop=mCapTop*v;var capBottom=height-(mHeight-capTop-capSize)*v;ctx.drawImage(img,0,0,mCapLeft,mCapTop,0,0,capLeft,capTop);ctx.drawImage(img,0,mCapTop,mCapLeft,capSize,0,capTop,capLeft,capBottom-capTop);ctx.drawImage(img,0,mCapTop+capSize,mCapLeft,mHeight-mCapTop-capSize,0,capBottom,capLeft,height-capBottom);ctx.drawImage(img,mCapLeft,0,capSize,mCapTop,capLeft,0,capRight-capLeft,capTop);ctx.drawImage(img,mCapLeft,mCapTop,capSize,capSize,capLeft,capTop,capRight-capLeft,capBottom-capTop);ctx.drawImage(img,mCapLeft,mCapTop+capSize,capSize,mHeight-mCapTop-capSize,capLeft,capBottom,capRight-capLeft,height-capBottom);ctx.drawImage(img,mCapLeft+capSize,0,mWidth-mCapLeft-capSize,mCapTop,capRight,0,width-capRight,capTop);ctx.drawImage(img,mCapLeft+capSize,mCapTop,mWidth-mCapLeft-capSize,capSize,capRight,capTop,width-capRight,capBottom-capTop);ctx.drawImage(img,mCapLeft+capSize,mCapTop+capSize,mWidth-mCapLeft-capSize,mHeight-mCapTop-capSize,capRight,capBottom,width-capRight,height-capBottom)}view.style.backgroundImage="url("+canvas.toDataURL("image/png")+")";view.style.backgroundSize="100% 100%"}else if(image){view.style.backgroundImage="url("+image.getURL()+")";view.style.backgroundSize="100% 100%"}else{view.style.backgroundImage=""}}else{view.style.backgroundImage=""}},setNeedUpdateBackgroundView:function(){if(!this.view){return}if(this._updateBackgroundView){return}var v=this.get("background-image");if(v){var vs=(v||"").split(" ");if(vs.length>1){var element=this;this.app.post(function(){element.updateBackgroundView()})}else{this.updateBackgroundView()}}},viewDidLayouted:function(view){view.style.position="absolute";view.style.width=this.frame.width+"px";view.style.height=this.frame.height+"px";view.style.left=this.frame.x+"px";view.style.top=this.frame.y+"px";this.setNeedUpdateBackgroundView()},obtainView:function(view,addSubview){if(this.view&&this.view.parentElement==view){this.obtainChildrenView();return}this.recycleView();if(this.frame.width<=0||this.frame.height<=0){return}var v=this.createView();this.setView(v);var keys=this.keys();for(var i=0;i<keys.length;i++){var key=keys[i];var value=this.get(key);this.viewChangedKey(v,key,value)}this.viewDidLayouted(v);this.obtainChildrenView();this.viewWillAppear(v);if(typeof addSubview=="function"){addSubview(v,this,view)}else if(this.parent instanceof kk.ViewElement){this.parent.addSubview(v,this,view)}else{view.appendChild(v)}this.viewDidAppear(v)},viewWillAppear:function(view){},viewDidAppear:function(view){},viewWillDisappear:function(view){},viewDidDisappear:function(view){},recycle:function(){this.recycleView(false);kk.Element.prototype.recycle.apply(this,arguments)},onRecycleView:function(view){},recycleView:function(isRecycleChildrenView){if(isRecycleChildrenView===undefined){isRecycleChildrenView=true}if(this.view){this.onRecycleView(this.view);var p=this.view.parentElement;if(p){this.viewWillDisappear(this.view);p.removeChild(this.view);this.viewDidDisappear(this.view)}this.setView(null)}if(isRecycleChildrenView){var e=this.firstChild;while(e){if(e instanceof kk.ViewElement){e.recycleView()}e=e.nextSibling}}},contentView:function(){return this.view},obtainChildrenView:function(){var v=this.contentView();if(v){var p=this.firstChild;while(p){if(p instanceof kk.ViewElement){p.obtainView(v)}p=p.nextSibling}}},remove:function(){this.recycleView();kk.Element.prototype.remove.apply(this,arguments)},addSubview:function(view,element,toView){var v=element.get("floor");if(v=="back"){if(toView.firstElementChild){toView.insertBefore(view,toView.firstElementChild)}else{toView.appendChild(view)}}else{toView.appendChild(view)}},isHidden:function(){return this.get("hidden")=="true"},layoutChildren:function(){if(this._layout){this.contentSize=this._layout(this)}},didLayouted:function(){if(this.prevSibling){this.zIndex=this.prevSibling.zIndex+1}if(this.view){this.viewDidLayouted(this.view)}},layout:function(width,height){this.frame.width=width;this.frame.height=height;if(this._layout){this.contentSize=this._layout(this)}this.didLayouted()},setContentOffset:function(x,y){this.contentOffset.x=x;this.contentOffset.y=y},onResize:function(){this.changedKeys(["border-width","border-radius"]);var e=this.firstChild;while(e){if(e instanceof kk.ViewElement){e.onResize()}e=e.nextSibling}}});(function(){var Layout=function(element){var size={width:0,height:0};if(element instanceof kk.ImageElement){if(element.width.type==kk.Pixel.TYPE_AUTO||element.height.type==kk.Pixel.TYPE_AUTO){var imageSize=element.getImageSize();if(element.width.type==kk.Pixel.TYPE_AUTO&&element.height.type==kk.Pixel.TYPE_AUTO){size=imageSize}else if(element.width.type==kk.Pixel.TYPE_AUTO){if(imageSize.height>0){size.width=size.height*imageSize.width/imageSize.height}else{size.width=0}}else{if(imageSize.width>0){size.height=size.width*imageSize.height/imageSize.width}else{size.height=0}}}else{size.width=element.width.valueOf(element.frame.width,0);size.height=element.width.valueOf(element.frame.height,0)}var v=element.minWidth.valueOf(0,0);if(size.width<v){size.width=v}v=element.maxWidth.valueOf(0,-1);if(v>0&&size.width>v){size.width=v}v=element.minHeight.valueOf(0,0);if(size.height<v){size.height=v}v=element.maxHeight.valueOf(0,-1);if(v>0&&size.height>v){size.height=v}element.contentSize=size}return size};kk.ImageElement=function(){kk.ViewElement.apply(this,arguments);this._layout=Layout};kk.ImageElement.prototype=kk.extend(kk.ViewElement.prototype,{viewChangedKey:function(view,key,value){kk.ViewElement.prototype.viewChangedKey.apply(this,arguments);if(key=="src"||key=="default-src"){this.display()}},setView:function(view){kk.ViewElement.prototype.setView.apply(this,arguments);if(view){$(view).off("click")}},getImageSize:function(){var size={width:0,height:0};var v=this.get("src");if(v){var image=this.app.getImage(v);if(image){size.width=image.width();size.height=image.height()}}return size},resizeImageView:function(view,image){if(view===undefined){view=this.getImageView();if(image===undefined){var v=this.get("src");if(v){image=this.app.getImage(v)}if(!image){v=this.get("default-src");if(v){image=this.app.getImage(v)}}}}if(view&&image&&image.width()>0&&image.height()>0&&this.frame.width>0&&this.frame.height>0){var gravity=this.get("gravity");if(gravity=="resize"){view.style.width="100%";view.style.height="100%";view.style.top="0px";view.style.left="0px"}else{var xScale=this.frame.width/image.width();var yScale=this.frame.height/image.height();var scale=gravity=="resizeAspect"?Math.min(xScale,yScale):Math.max(xScale,yScale);var toWidth=image.width()*scale;var toHeight=image.height()*scale;var mleft=(this.frame.width-toWidth)*.5;var mtop=(this.frame.height-toHeight)*.5;view.style.width=toWidth+"px";view.style.height=toHeight+"px";view.style.top=mtop+"px";view.style.left=mleft+"px"}}},display:function(){var view=this.getImageView();if(!view){return}var image;var v=this.get("src");if(v){image=this.app.getImage(v)}if(!image){v=this.get("default-src");if(v){image=this.app.getImage(v)}}if(image){view.setAttribute("src",image.getURL());if(image.loaded){this.resizeImageView(view,image)}else{var e=this;image.onload=function(){e.resizeImageView(view,image)}}}},getImageView:function(){if(this.view){return this.view.firstChild}},createView:function(){var v=document.createElement("div");v.className="kk-view kk-image";v.style.overflow="hidden";var img=document.createElement("img");img.style.position="absolute";img.style.width="100%";v.appendChild(img);return v},setLayout:function(){this._layout=Layout},viewDidLayouted:function(view){kk.ViewElement.prototype.viewDidLayouted.apply(this,arguments);this.resizeImageView()}})})();(function(){var Layout=function(element){var size={width:0,height:0};if(element instanceof kk.TextElement){if(element.width.type==kk.Pixel.TYPE_AUTO||element.height.type==kk.Pixel.TYPE_AUTO){var textSize=element.getTextSize();if(element.width.type==kk.Pixel.TYPE_AUTO){size.width=Math.ceil(textSize.width+1)+element.padding.left.valueOf(0,0)+element.padding.right.valueOf(0,0)}if(element.height.type==kk.Pixel.TYPE_AUTO){size.height=Math.ceil(textSize.height+1)+element.padding.top.valueOf(0,0)+element.padding.bottom.valueOf(0,0)}}else{size.width=element.width.valueOf(element.frame.width,0);size.height=element.width.valueOf(element.frame.height,0)}var v=element.minWidth.valueOf(0,0);if(size.width<v){size.width=v}v=element.maxWidth.valueOf(0,-1);if(v>0&&size.width>v){size.width=v}v=element.minHeight.valueOf(0,0);if(size.height<v){size.height=v}v=element.maxHeight.valueOf(0,-1);if(v>0&&size.height>v){size.height=v}element.contentSize=size}return size};var getAttribute=function(key){var v;for(var i=1;i<arguments.length;i++){var e=arguments[i];if(e&&e instanceof kk.Element){v=e.get(key);if(v!==undefined){break}}}return v};var textAttribute=function(view,element,textElement){var v=getAttribute("font",element,textElement);if(v){kk.Font.parse(v,view)}v=getAttribute("color",element,textElement);if(v){view.style.color=kk.Color.parse(v)}v=getAttribute("text-decoration",element,textElement);if(v){view.style.textDecoration=v}v=getAttribute("text-stroke",element,textElement);if(v){var size=new kk.Pixel;var color;var vs=v.split(" ");for(var i=0;i<vs.length;i++){v=vs[i];if(kk.Pixel.is(v)){size.set(v)}else{color=kk.Color.parse(v)}}if(color&&size.type!=kk.Pixel.TYPE_AUTO){view.style.webkitTextStroke=view.style.textStroke="1px "+color}}if(element.maxWidth&&element.maxWidth.type!=kk.Pixel.TYPE_AUTO){view.style.maxWidth=element.maxWidth.valueOf(0,0)+"px"}};kk.SpanElement=function(){kk.Element.apply(this,arguments)};kk.SpanElement.prototype=kk.extend(kk.Element.prototype,{changedKey:function(key){kk.Element.prototype.changedKey.apply(this,arguments);if(this.parent&&this.parent instanceof kk.TextElement){this.parent.setNeedDisplay()}},textView:function(element){var view=document.createElement("span");textAttribute(view,this,element);view.innerText=this.get("#text")||"";return view}});kk.ImgElement=function(){kk.Element.apply(this,arguments);this.width=new kk.Pixel;this.height=new kk.Pixel};kk.ImgElement.prototype=kk.extend(kk.Element.prototype,{changedKey:function(key){kk.Element.prototype.changedKey.apply(this,arguments);if(key=="width"){this.width.set(this.get(key))}else if(key=="height"){this.height.set(this.get(key))}if(this.parent&&this.parent instanceof kk.TextElement){this.parent.setNeedDisplay()}},textView:function(element){var view=document.createElement("img");var image=this.app.getImage(this.get("src"));if(image){var width=image.width();var height=image.height();if(width>0&&height>0){if(this.width.type==kk.Pixel.TYPE_AUTO&&this.height.type==kk.Pixel.TYPE_AUTO){}else if(this.width.type==kk.Pixel.TYPE_AUTO){var v=this.height.valueOf(0,0);width=v*width/height;height=v}else if(this.height.type==kk.Pixel.TYPE_AUTO){var v=this.width.valueOf(0,0);height=v*height/width;width=v}else{width=this.width.valueOf(0,0);height=this.height.valueOf(0,0)}view.style.width=width+"px";view.style.height=height+"px";view.src=image.getURL()}else{view.style.width=this.width.valueOf(0,0)+"px";view.style.height=this.width.valueOf(0,0)+"px"}}else{view.style.width=this.width.valueOf(0,0)+"px";view.style.height=this.width.valueOf(0,0)+"px"}return view}});kk.TextElement=function(){kk.ViewElement.apply(this,arguments);this.layout=Layout;this.displaying=false;this._layout=Layout};kk.TextElement.prototype=kk.extend(kk.ViewElement.prototype,{viewChangedKey:function(view,key,value){kk.ViewElement.prototype.viewChangedKey.apply(this,arguments);switch(key){case"font":kk.Font.parse(value,view.firstChild,this.lineSpacing.valueOf(0,0));break;case"line-spacing":kk.Font.parse(this.get("font"),view.firstChild,this.lineSpacing.valueOf(0,0));break;case"text-decoration":view.firstChild.style.textDecoration=value||"none";break}this.setNeedDisplay()},setView:function(view){kk.ViewElement.prototype.setView.apply(this,arguments)},viewDidAppear:function(view){},willRemoveChildren:function(element){kk.ViewElement.prototype.willRemoveChildren.apply(this,arguments);this.setNeedDisplay()},didAddChildren:function(element){this.setNeedDisplay();kk.ViewElement.prototype.didAddChildren.apply(this,arguments)},getTextSize:function(){var view=document.createElement("div");var p=this.firstChild;if(!p){view.innerText=this.get("#text")||""}else{while(p){if(p instanceof kk.SpanElement){view.appendChild(p.textView(this))}else if(p instanceof kk.ImgElement){view.appendChild(p.textView(this))}p=p.nextSibling}}textAttribute(view,this);view.className="kk-view kk-text";view.style.position="absolute";view.style.top="-8000px";document.body.appendChild(view);var size={width:view.clientWidth+2,height:view.clientHeight};document.body.removeChild(view);this._textSize=size;return size},display:function(){this.displaying=false;if(!this.view){return}var p=this.firstChild;var view=this.view.firstChild;textAttribute(view,this);if(!p){view.innerText=(this.get("#text")||"").replace("\n","<br/>")}else{view.innerText="";while(p){if(p instanceof kk.SpanElement){view.appendChild(p.textView(this))}else if(p instanceof kk.ImgElement){view.appendChild(p.textView(this))}p=p.nextSibling}}},setNeedDisplay:function(){if(this.displaying||!this.view){return}this.displaying=true;var e=this;this.app.post(function(){e.display()})},createView:function(){var v=document.createElement("div");v.className="kk-view kk-text";var pre=document.createElement("span");pre.style.display="inline-block";pre.style.verticalAlign="top";pre.style.margin="0px";pre.style.padding="0px";v.appendChild(pre);return v},setLayout:function(){this._layout=Layout},viewDidLayouted:function(view){kk.ViewElement.prototype.viewDidLayouted.apply(this,arguments);this.changedKeys(["font","line-spacing"]);if(this._textSize===undefined){this.getTextSize()}var mtop=(this.frame.height-this._textSize.height)*.5;view.firstChild.style.margin=mtop+"px 0px 0px 0px"}})})();(function(){kk.ButtonElement=function(){kk.ViewElement.apply(this,arguments)};kk.ButtonElement.prototype=kk.extend(kk.ViewElement.prototype,{viewChangedKey:function(view,key,value){kk.ViewElement.prototype.viewChangedKey.apply(this,arguments);if(key=="enabled"){view.disabled=!kk.booleanValue(value,true)}if(key=="selected"||key=="enabled"){this.updateStatus()}},updateStatus:function(){if(!kk.booleanValue(this.get("enabled"),true)){this.set("status","disabled")}else if(this.get("selected")=="true"){this.set("status","selected")}else if(this.hover){this.set("status","hover")}else{this.set("status","")}},setHover:function(hover){this.hover=hover;this.updateStatus()},createView:function(){var e=document.createElement("button");e.className="kk-view kk-button";return e},doTapAction:function(){var e=new kk.ElementEvent(this);e.data=this.data();this.emit("tap",e)},viewDidAppear:function(view){var element=this;var app=this.app;$(view).on("click",function(event){event.stopPropagation();kk.pushApp(app);element.doTapAction();kk.popApp()}).on("mousedown",function(event){event.stopPropagation();kk.pushApp(app);element.setHover(true);kk.popApp()}).on("mouseup",function(event){event.stopPropagation();kk.pushApp(app);element.setHover(false);kk.popApp()}).on("touchstart",function(){kk.pushApp(app);element.setHover(true);kk.popApp()}).on("touchend",function(){kk.pushApp(app);element.setHover(false);kk.popApp()}).on("touchcancel",function(){kk.pushApp(app);element.setHover(false);kk.popApp()})},setView:function(view){kk.ViewElement.prototype.setView.apply(this,arguments)}})})();(function(){kk.WebViewElement=function(){kk.ViewElement.apply(this,arguments);this._onEvents=[]};kk.WebViewElement.prototype=kk.extend(kk.ViewElement.prototype,{createView:function(){var v=document.createElement("iframe");v.setAttribute("frameborder","0");v.setAttribute("seamless","seamless");return v},onLoaded:function(){this.loaded=true;while(this._onEvents.length){var v=this._onEvents.shift();if(this.view&&this.view.contentWindow){var fn=this.view.contentWindow["on"+v.name];if(typeof fn=="function"){fn(v.data)}}}},setView:function(view){kk.ViewElement.prototype.setView.apply(this,arguments);if(view){var element=this;$(view).bind("load",function(){element.onLoaded()})}},viewChangedKey:function(view,key,value){kk.ViewElement.prototype.viewChangedKey.apply(this,arguments);if(key=="src"){view.setAttribute("src",value)}},emit:function(name,event){kk.ViewElement.prototype.emit.apply(this,arguments);if(event instanceof kk.ElementEvent){event.cancelBubble=true;if(this.loaded){var fn=this.view.contentWindow["on"+name];if(typeof fn=="function"){fn(event.data)}}else{this._onEvents.push({name:name,data:event.data})}}}})})();(function(){var PositionTypeTop="top";var PositionTypeBottom="bottom";var isPositionType=function(type){return type==PositionTypeTop||type==PositionTypeBottom};kk.ScrollViewElement=function(){kk.ViewElement.apply(this,arguments);this.contentOffset={x:0,y:0};this.positionViews={};this.onScrollId=undefined;this.tracking=false;this.scrolling=false};kk.ScrollViewElement.prototype=kk.extend(kk.ViewElement.prototype,{createView:function(){var v=document.createElement("div");v.className="kk-view";v.scrollView=document.createElement("div");v.scrollView.className="kk-scrollview";v.scrollView.style.position="relative";v.scrollView.style.width="100%";v.scrollView.style.height="100%";v.appendChild(v.scrollView);v.contentView=document.createElement("div");v.scrollView.appendChild(v.contentView);return v},clearPositionView:function(type){var contentView=this.contentView();if(!contentView){return contentView}var v=this.positionViews[type];if(v){if(v.firstChild&&v.element){var view=v.firstChild;v.removeChild(view);view.style.left=v.element.frame.x+"px";view.style.top=v.element.frame.y+"px";this.addSubview(view,v.element,contentView)}v.style.display="none";delete v.element}},setPositionView:function(element,type){var contentView=this.contentView();if(!contentView){return}if(!isPositionType(type)){return}if(element instanceof kk.ViewElement){var view=element.view;if(view){var v=this.positionViews[type];if(v){if(v.element!=element){this.clearPositionView(type)}else{return}}else{v=document.createElement("div");v.style.display="none";v.style.margin="0px";v.style.padding="0px";if(type==PositionTypeBottom){v.style.position="absolute";v.style.width="100%";v.style.left="0px";var bottom=this.padding.bottom.valueOf(0,0);v.style.bottom=bottom+"px"}else if(type==PositionTypeTop){v.style.position="absolute";v.style.width="100%";v.style.left="0px";var top=this.padding.top.valueOf(0,0);v.style.top=top+"px"}this.view.appendChild(v);this.positionViews[type]=v}if(view.parentNode){view.parentNode.removeChild(view)}view.style.top="0px";view.style.left="0px";v.appendChild(view);v.style.display="block";v.element=element}else{this.clearPositionView(type)}}else{this.clearPositionView(type)}},onScroll:function(x,y){this.contentOffset={x:x,y:y};var contentView=this.contentView();var e=this.firstChild;while(e){if(e instanceof kk.ViewElement){var view=e.view;if(view){var type=e.get("position");switch(type){case"top":var top=e.margin.top.valueOf(0,0);if(y-e.frame.y>top){this.setPositionView(e,type)}else{this.setPositionView(undefined,type)}break;case"bottom":var bottom=e.margin.bottom.valueOf(0,0);var dy=y+this.frame.height-e.frame.height-bottom-e.frame.y;if(dy>0){this.setPositionView(e,type)}else{this.setPositionView(undefined,type)}break}}}e=e.nextSibling}if(this.hasEvent("scroll")){var data={tracking:this.tracking,x:x,y:y,w:this.contentSize.width,h:this.contentSize.height,width:this.frame.width,height:this.frame.height};var e=new kk.ElementEvent(this);e.data=data;this.emit("scroll",e)}if(!this.anchorScrolling&&this.hasEvent("anchor")){var p=this.lastChild;var anchor;var element;var margin=new kk.Edge;while(p){if(p instanceof kk.ViewElement){anchor=p.get("anchor");if(anchor!==undefined){margin.set(p.get("anchor-margin"));if(y>=p.frame.y-margin.top.valueOf(0,0)){element=p;break}}}p=p.prevSibling}if(element){if(anchor!=this.anchor){this.anchor=anchor;var data={tracking:this.tracking,x:x,y:y,w:this.contentSize.width,h:this.contentSize.height,width:this.frame.width,height:this.frame.height,view:{width:element.frame.width,height:element.frame.height,x:element.frame.x,y:element.frame.y,anchor:anchor}};var e=new kk.ElementEvent(this);e.data=data;this.emit("anchor",e)}}}},setView:function(view){if(this.onScrollId){clearInterval(this.onScrollId);delete this.onScrollId}this.positionViews={};kk.ViewElement.prototype.setView.apply(this,arguments);if(view){var scrollView=view.scrollView;var element=this;var scrollX=undefined;var scrollY=undefined;this.onScrollId=setInterval(function(){if(scrollView.scrollTop!=scrollY||scrollView.scrollLeft!=scrollX){scrollX=scrollView.scrollLeft;scrollY=scrollView.scrollTop;element.onScroll(scrollX,scrollY)}},1e3/60);$(view).on("touchstart",function(e){element.setTracking(true)}).on("touchend",function(e){element.setTracking(false)}).on("touchcancel",function(e){element.setTracking(false)})}},setTracking:function(v){this.tracking=v;if(v){this.cancelScroll()}},contentView:function(){return this.view?this.view.contentView:undefined},viewDidLayouted:function(view){kk.ViewElement.prototype.viewDidLayouted.apply(this,arguments);var v=this.contentView();if(v){var width=this.contentSize.width;if(this.get("overflow-x")=="scroll"){width=Math.max(width,this.frame.width);this.view.scrollView.style.overflowX="scroll"}var height=this.contentSize.height;if(this.get("overflow-y")=="scroll"){height=Math.max(height,this.frame.height);this.view.scrollView.style.overflowY="scroll"}v.style.width=width+"px";v.style.height=height+"px"}},cancelScroll:function(){if(this.scrolling){clearInterval(this.scrolling.id);if(typeof this.scrolling.fn=="function"){this.scrolling.fn(false)}this.scrolling=false}},scrollTo:function(x,y,animated,fn){this.cancelScroll();if(this.view&&this.view.scrollView){if(!animated){this.view.scrollView.scrollTo(x,y);if(typeof fn=="function"){fn()}return}var element=this;this.scrolling={fn:fn};var cur={x:this.view.scrollView.scrollLeft,y:this.view.scrollView.scrollTop,duration:300,start:(new Date).getTime(),view:this.view.scrollView};this.scrolling.id=cur.id=setInterval(function(){var v=(new Date).getTime();var a=(v-cur.start)/cur.duration;if(a>=1){cur.view.scrollLeft=x;cur.view.scrollTop=y;clearInterval(cur.id);element.scrolling=false;if(typeof fn=="function"){fn()}}else{cur.view.scrollLeft=cur.x+(x-cur.x)*a;cur.view.scrollTop=cur.y+(y-cur.y)*a}},1e3/60)}else{if(typeof fn=="function"){fn()}}},emit:function(name,event){kk.ViewElement.prototype.emit.apply(this,arguments);if(event instanceof kk.ElementEvent){if(name=="scrolltop"){event.cancelBubble=true;if(this.view&&this.view.scrollView){this.scrollTo(0,0,true)}}else if(name=="anchor"){event.cancelBubble=true;if(this.view&&this.view.scrollView){var margin=new kk.Edge;if(event.data&&event.data.margin){margin.set(event.data.margin)}if(event.data&&event.data.anchor){var anchor=event.data.anchor;var element;var p=this.firstChild;while(p){if(p instanceof kk.ViewElement){var v=p.get("anchor");if(v!==undefined&&v==anchor){element=p;break}}p=p.nextSibling}if(element){var x=element.frame.x-margin.left.valueOf(0,0);var y=element.frame.y-margin.top.valueOf(0,0);var e=this;e.anchorScrolling=true;this.scrollTo(x,y,true,function(){e.anchorScrolling=false})}}}}}}})})();(function(){kk.SlideViewElement=function(){kk.ScrollViewElement.apply(this,arguments)};kk.SlideViewElement.prototype=kk.extend(kk.ScrollViewElement.prototype,{viewChangedKey:function(view,key,value){kk.ScrollViewElement.prototype.viewChangedKey.apply(this,arguments);if(key=="anchor"){this.updateAnchor(true)}},curElementView:function(){if(this._curElementView===undefined){var e=this.firstChild;while(e){if(e.get("#name")=="slide:cur"){break}e=e.nextSibling}if(e&&e.firstChild&&e.firstChild instanceof kk.ViewElement){this._curElementView=e.firstChild}else{this._curElementView=null}}return this._curElementView},onResize:function(){this.updateAnchor(false);kk.ScrollViewElement.prototype.onResize.apply(this,arguments)},obtainChildrenView:function(){kk.ScrollViewElement.prototype.obtainChildrenView.apply(this,arguments);this.updateAnchor(false)},updateAnchor:function(animated){var element;var anchor=this.get("anchor");if(anchor){var e=this.firstChild;while(e){if(e instanceof kk.ViewElement){if(anchor==e.get("anchor")){element=e}e.set("selected",e==element?"true":"false")}e=e.nextSibling}}var cur=this.curElementView();var contentView=this.contentView();if(cur&&contentView){if(element){var size={width:element.frame.width,height:this.frame.height};size.width=cur.width.valueOf(size.width,0);size.height=cur.height.valueOf(size.height,0);var centerX=element.frame.x+element.frame.width*.5;cur.frame.x=centerX-size.width*.5;cur.frame.y=0;kk.pushApp(this.app);cur.layout(size.width,size.height);cur.obtainView(contentView,function(view,element,toView){if(toView.firstElementChild){toView.insertBefore(view,toView.firstElementChild)}else{toView.appendChild(view)}});kk.popApp()}else{cur.recycleView()}}},viewDidLayouted:function(view){kk.ViewElement.prototype.viewDidLayouted.apply(this,arguments);this.updateAnchor(false)}})})();(function(){kk.PagerViewElement=function(){kk.ScrollViewElement.apply(this,arguments);this.pageScrollX=0;this.pageScrollV=0;this.loop=true};kk.PagerViewElement.prototype=kk.extend(kk.ScrollViewElement.prototype,{changedKey:function(key){kk.ScrollViewElement.prototype.changedKey.apply(this,arguments);if(key=="loop"){this.loop=this.get(key)=="true"}},setView:function(view){kk.ScrollViewElement.prototype.setView.apply(this,arguments);if(view&&view.scrollView){view.scrollView.style.overflowX="scroll";$(view.scrollView).on("mousewheel",function(e){e.preventDefault();e.stopPropagation()})}},viewDidLayouted:function(view){kk.ScrollViewElement.prototype.viewDidLayouted.apply(this,arguments);this.loopPageIndex(true)},pageSize:function(){if(this.frame.width>0){return parseInt(Math.ceil(this.contentSize.width/this.frame.width))}return 0},pageIndex:function(){if(this.frame.width>0&&this.view&&this.view.scrollView){return parseInt(this.view.scrollView.scrollLeft/this.frame.width)}return 0},setPageIndex:function(index,animated,done){var n=this.pageSize();if(index<n){this.scrollTo(this.frame.width*index,0,animated,done)}else{if(typeof done=="function"){done()}}},loopPageIndex:function(top){var i=this.pageIndex();var n=this.pageSize();if(this.loop){if(n>=3){if(top){i=1;this.setPageIndex(1,false)}else if(i==0){i=n-2;this.setPageIndex(n-2,false)}else if(i==n-1){i=1;this.setPageIndex(1,false)}n=n-2;i=i-1}}var e=new kk.ElementEvent(this);e.data={pageIndex:i,pageCount:n};this.emit("pagechange",e)},updatePageScroll:function(animated){var element=this;var done=function(canceled){if(canceled===false){return}element.loopPageIndex()};if(this.pageScrollV>0){var n=this.pageSize();var i=this.pageIndex();if(i+1<n){this.setPageIndex(i+1,animated,done)}else{this.setPageIndex(i,animated,done)}}else{this.setPageIndex(this.pageIndex(),animated,done)}this.pageScrollV=0},onScroll:function(x,y){var v=x-this.pageScrollX;if(v!=0){this.pageScrollX=x;this.pageScrollV=v}kk.ScrollViewElement.prototype.onScroll.apply(this,arguments)},setTracking:function(v){kk.ScrollViewElement.prototype.setTracking.apply(this,arguments);if(v){this.pageScrollX=this.contentOffset.x}else{this.updatePageScroll(true)}}})})();(function(){kk.AppElement=function(){kk.ViewElement.apply(this,arguments)};kk.AppElement.prototype=kk.extend(kk.ViewElement.prototype,{viewChangedKey:function(view,key,value){kk.ViewElement.prototype.viewChangedKey.apply(this,arguments);if(key=="src"){this.load(value)}},setView:function(view){if(this._app){this._app.recycle();delete this._app}kk.ViewElement.prototype.setView.apply(this,arguments)},load:function(url){if(!this.view){return false}if(this._app&&this._app.data.get(["url"])==url){return true}if(this._app){var v=this._app;delete this._app;this.app.post(function(){v.recycle()})}if(url&&(url.startsWith("http://")||url.startsWith("https://"))){}else{return false}var app=this._app=new kk.Application;(function(){var v=this.get("orientation");if(v!==undefined){app.orientation=v}v=this.get("unit-rpx");if(v!==undefined){app.UnitRPX=v}})();var query=app.data.get(["query"])||{};var queryString=url;var i=queryString.indexOf("?");if(i>0){queryString=queryString.substr(i+1)}queryString.replace(/([^&=\?]+)=([^&=\?]*)/g,function(text,name,value){query[name]=decodeURIComponent(value)});app.data.set(["query"],query);app.data.on(["alert"],function(data){alert(data)});app.run(url,this.view)},createView:function(){var e=document.createElement("div");e.setAttribute("class","kk-view kk-app");return e}})})();(function(){kk.PageElement=function(){kk.ViewElement.apply(this,arguments)};kk.PageElement.prototype=kk.extend(kk.ViewElement.prototype,{viewChangedKey:function(view,key,value){kk.ViewElement.prototype.viewChangedKey.apply(this,arguments);if(key=="path"){this.open(value)}else if(key=="hidden"){if(!kk.booleanValue(value,false)&&this._page){this._page.resize(this.frame.width,this.frame.height,view)}}},viewDidLayouted:function(view){kk.ViewElement.prototype.viewDidLayouted.apply(this,arguments);if(!kk.booleanValue(this.get("hidden"))&&this._page){this._page.resize(this.frame.width,this.frame.height,view)}},setView:function(view){if(this._page){this._page.recycle();this._page.recycleView();delete this._page}kk.ViewElement.prototype.setView.apply(this,arguments)},onRecycleView:function(view){kk.ViewElement.prototype.onRecycleView.apply(this,arguments);if(this._page){this._page.recycle();this._page.recycleView();delete this._page}},open:function(path){if(!this.view){return false}if(this._page&&this._page.data.get(["url"])==path){return true}if(this._page){var p=this._page;delete this._page;p.recycle();this.app.post(function(){p.recycleView()})}if(!path){return false}var element=this;var page=this._page=new kk.Page(kk.getApp());var query=this.data();page.data.set(["url"],path);var i=path.indexOf("?");if(i>0){path.substr(i+1).replace(/([^&=\?]+)=([^&=\?]*)/g,function(text,name,value){query[name]=decodeURIComponent(value)});path=path.substr(0,i)}page.data.set(["path"],path);page.data.set(["query"],query);page.data.on(["action","close"],function(data){var e=new kk.ElementEvent(element);e.data=data;element.emit("close",e)});page.data.on(["action","open"],function(data){var e=new kk.ElementEvent(element);e.data=data;element.emit("open",e)});page.open(path);page.obtainView(this.view)},createView:function(){var e=document.createElement("div");e.setAttribute("class","kk-view kk-page");return e}})})();(function(){kk.InputElement=function(){kk.ViewElement.apply(this,arguments)};kk.InputElement.prototype=kk.extend(kk.ViewElement.prototype,{viewChangedKey:function(view,key,value){kk.ViewElement.prototype.viewChangedKey.apply(this,arguments);switch(key){case"font":kk.Font.parse(value,view,this.lineSpacing.valueOf(0,0));break;case"line-spacing":kk.Font.parse(this.get("font"),view,this.lineSpacing.valueOf(0,0));break;case"text-decoration":view.style.textDecoration=value||"none";break;case"enabled":view.disabled=!kk.booleanValue(value);this.updateStatus();break;case"type":if(value=="number"){value="text"}view.setAttribute("type",value);break;case"placeholder":view.setAttribute("placeholder",value);break;case"autofocus":if(kk.booleanValue(value)){var element=this;this.app.post(function(){element.focusUpdatting=true;view.focus();element.focusUpdatting=false})}break;case"value":view.value=value;break}},updateStatus:function(){if(this.get("enabled")!="true"){this.set("status","disabled")}else if(this.active){this.set("status","active")}else{this.set("status","")}},setActive:function(active){this.active=active;this.updateStatus()},createView:function(){var e=document.createElement("input");e.setAttribute("class","kk-view kk-input");return e},viewDidAppear:function(view){var element=this;var app=this.app;var change=function(event){event.stopPropagation();kk.pushApp(app);var e=new kk.ElementEvent(element);e.data=element.data();e.data["value"]=this.value;element.emit("change",e);kk.popApp()};$(view).on("focus",function(event){event.stopPropagation();kk.pushApp(app);element.setActive(true);if(!element.focusUpdatting){var e=new kk.ElementEvent(element);e.data=element.data();e.data["value"]=this.value;element.emit("focus",e)}kk.popApp()}).on("blur",function(event){event.stopPropagation();kk.pushApp(app);element.setActive(false);var e=new kk.ElementEvent(element);e.data=element.data();e.data["value"]=this.value;element.emit("blur",e);kk.popApp();change.apply(this,arguments)}).on("keyup",function(event){event.stopPropagation();change.apply(this,arguments);if(event.keyCode==13){kk.pushApp(app);var e=new kk.ElementEvent(element);e.data=element.data();e.data["value"]=this.value;element.emit("done",e);kk.popApp()}})},viewDidLayouted:function(view){kk.ViewElement.prototype.viewDidLayouted.apply(this,arguments);view.style.padding=this.padding.toString()}})})();(function(){kk.SelectElement=function(){kk.ViewElement.apply(this,arguments)};kk.SelectElement.prototype=kk.extend(kk.ViewElement.prototype,{viewChangedKey:function(view,key,value){kk.ViewElement.prototype.viewChangedKey.apply(this,arguments);switch(key){case"font":kk.Font.parse(value,view,this.lineSpacing.valueOf(0,0));break;case"line-spacing":kk.Font.parse(this.get("font"),view,this.lineSpacing.valueOf(0,0));break;case"text-decoration":view.style.textDecoration=value||"none";break;case"enabled":view.disabled=!kk.booleanValue(value);this.updateStatus();break;case"autofocus":if(kk.booleanValue(value)){var element=this;this.app.post(function(){element.focusUpdatting=true;view.focus();element.focusUpdatting=false})}break;case"value":view.value=value;break}},updateStatus:function(){if(this.get("enabled")!="true"){this.set("status","disabled")}else if(this.active){this.set("status","active")}else{this.set("status","")}},setActive:function(active){this.active=active;this.updateStatus()},createView:function(){var e=document.createElement("select");e.setAttribute("class","kk-view kk-select");return e},updateOptions:function(){var e=this.view;if(!e){return}e.innerHTML="";var p=this.firstChild;var value=this.get("value");while(p){if(p.get("#name")=="option"){var v=document.createElement("option");var vv=p.get("value");if(vv!==undefined){v.setAttribute("value",vv);if(value===undefined){value=vv}}v.textContent=p.get("#text");e.appendChild(v)}p=p.nextSibling}e.value=value},willRemoveChildren:function(element){kk.ViewElement.prototype.willRemoveChildren.apply(this,arguments);var v=this;this.app.post(function(){v.updateOptions()})},didAddChildren:function(element){kk.ViewElement.prototype.didAddChildren.apply(this,arguments);var v=this;this.app.post(function(){v.updateOptions()})},viewDidAppear:function(view){var element=this;var app=this.app;var change=function(event){event.stopPropagation();kk.pushApp(app);var e=new kk.ElementEvent(element);e.data=element.data();e.data["value"]=this.value;element.emit("change",e);kk.popApp()};$(view).on("focus",function(event){event.stopPropagation();kk.pushApp(app);element.setActive(true);if(!element.focusUpdatting){var e=new kk.ElementEvent(element);e.data=element.data();e.data["value"]=this.value;element.emit("focus",e)}kk.popApp()}).on("blur",function(event){event.stopPropagation();kk.pushApp(app);element.setActive(false);var e=new kk.ElementEvent(element);e.data=element.data();e.data["value"]=this.value;element.emit("blur",e);kk.popApp();change.apply(this,arguments)}).on("change",change).on("keyup",function(event){event.stopPropagation();if(event.keyCode==13){kk.pushApp(app);var e=new kk.ElementEvent(element);e.data=element.data();e.data["value"]=this.value;element.emit("done",e);kk.popApp()}});this.updateOptions()},viewDidLayouted:function(view){kk.ViewElement.prototype.viewDidLayouted.apply(this,arguments);view.style.padding=this.padding.toString()}})})();(function(){kk.BodyElement=function(){kk.ViewElement.apply(this,arguments)};kk.BodyElement.prototype=kk.extend(kk.ViewElement.prototype,{viewDidLayouted:function(view){this.setNeedUpdateBackgroundView()},obtainView:function(view,addSubview){if(this.view==view){this.obtainChildrenView();return}this.recycleView();if(this.frame.width<=0||this.frame.height<=0){return}var v=view;this.setView(v);var keys=this.keys();for(var i=0;i<keys.length;i++){var key=keys[i];var value=this.get(key);this.viewChangedKey(v,key,value)}this.viewDidLayouted(v);this.obtainChildrenView();this.viewWillAppear(v);this.viewDidAppear(v)},recycleView:function(){if(this.view){this.onRecycleView(this.view);this.viewWillDisappear(this.view);this.viewDidDisappear(this.view);this.setView(null)}var e=this.firstChild;while(e){if(e instanceof kk.ViewElement){e.recycleView()}e=e.nextSibling}},viewChangedKey:function(view,key,value){if(key=="z-index"){var e=this.firstChild;while(e){e.set(key,value);e=e.nextSibling}return}kk.ViewElement.prototype.viewChangedKey.apply(this,arguments)}})})();(function(){kk.TextareaElement=function(){kk.ViewElement.apply(this,arguments)};kk.TextareaElement.prototype=kk.extend(kk.ViewElement.prototype,{viewChangedKey:function(view,key,value){kk.ViewElement.prototype.viewChangedKey.apply(this,arguments);switch(key){case"font":kk.Font.parse(value,view,this.lineSpacing.valueOf(0,0));break;case"line-spacing":kk.Font.parse(this.get("font"),view,this.lineSpacing.valueOf(0,0));break;case"text-decoration":view.style.textDecoration=value||"none";break;case"enabled":view.disabled=!kk.booleanValue(value);this.updateStatus();break;case"autofocus":if(kk.booleanValue(value)){var element=this;this.app.post(function(){element.focusUpdatting=true;view.focus();element.focusUpdatting=false})}break;case"#text":view.value=value;break}},updateStatus:function(){if(this.get("enabled")!="true"){this.set("status","disabled")}else if(this.active){this.set("status","active")}else{this.set("status","")}},setActive:function(active){this.active=active;this.updateStatus()},createView:function(){var e=document.createElement("textarea");e.setAttribute("class","kk-view kk-textarea");return e},viewDidAppear:function(view){var element=this;var app=this.app;var change=function(event){event.stopPropagation();kk.pushApp(app);var e=new kk.ElementEvent(element);e.data=element.data();e.data["value"]=this.value;element.emit("change",e);kk.popApp()};$(view).on("focus",function(event){event.stopPropagation();kk.pushApp(app);element.setActive(true);if(!element.focusUpdatting){var e=new kk.ElementEvent(element);e.data=element.data();e.data["value"]=this.value;element.emit("focus",e)}kk.popApp()}).on("blur",function(event){event.stopPropagation();kk.pushApp(app);element.setActive(false);var e=new kk.ElementEvent(element);e.data=element.data();e.data["value"]=this.value;element.emit("blur",e);kk.popApp();change.apply(this,arguments)})},viewDidLayouted:function(view){kk.ViewElement.prototype.viewDidLayouted.apply(this,arguments);view.style.padding=this.padding.toString()}})})();(function(){kk.AnimationElement=function(){kk.ViewElement.apply(this,arguments)};kk.AnimationElement.prototype=kk.extend(kk.Element.prototype,{startAnimation:function(element,view,fn){var from={};var to={};var app=element.app;var e=this.firstChild;while(e){var name=e.get("#name");if(name=="anim:opacity"){from.opacity=parseFloat(e.get("from"));to.opacity=parseFloat(e.get("to"))}else if(name=="anim:transform"){from.transform=kk.Transform.parse(e.get("from"));to.transform=kk.Transform.parse(e.get("to"))}e=e.nextSibling}$(view).css(from).animate(to,parseInt(this.get("duration"))||300,"liner",function(){kk.pushApp(app);if(typeof fn=="function"){fn()}kk.popApp()})}})})();(function(){var elements={view:kk.ViewElement,body:kk.ViewElement,text:kk.TextElement,span:kk.SpanElement,img:kk.ImgElement,image:kk.ImageElement,button:kk.ButtonElement,webview:kk.WebViewElement,scroll:kk.ScrollViewElement,slide:kk.SlideViewElement,animation:kk.AnimationElement,pager:kk.PagerViewElement,app:kk.AppElement,page:kk.PageElement,input:kk.InputElement,topbar:kk.Element,select:kk.SelectElement,option:kk.Element,textarea:kk.TextareaElement};var ViewEachAttribute=function(e,attrs,data){for(var key in attrs){var v=attrs[key];if(key.startsWith("kk:")){if(key=="kk:text"){data.on(v,function(value,keys){if(value!==undefined&&value!==null){e.set("#text",value+"")}})}else if(key=="kk:show"){data.on(v,function(value,keys){if(value!==undefined&&value!==null){e.set("hidden",value?"false":"true")}})}else if(key=="kk:hide"){data.on(v,function(value,keys){if(value!==undefined&&value!==null){e.set("hidden",value?"true":"false")}})}else if(key.startsWith("kk:on")){(function(keys){e.on(key.substr(5),function(event){if(event.element==e){var p=data;while(p.parent){p=p.parent}p.set(keys,event.data)}})})(v.split("."))}else if(key.startsWith("kk:emit_")){(function(name){data.on(v,function(value,keys){if(value!==undefined&&value!==null){var ev=new kk.ElementEvent(e);ev.data=value;e.emit(name,ev)}},true)})(key.substr(8))}else{(function(name){data.on(v,function(value,keys){if(value===undefined||value===null){e.set(name,"")}else{e.set(name,value+"")}})})(key.substr(3))}}else if(key.startsWith("style:")){e.setCSSStyle(v,key.substr(6))}else if(key=="style"){e.setCSSStyle(v,"")}else{e.set(key,v)}}};var ViewCreateWithName=function(name){var alloc=elements[name];if(alloc===undefined){alloc=kk.Element}return new alloc};var ViewCreate=function(name,attrs,element,data,fn){var e=ViewCreateWithName(name);ViewEachAttribute(e,attrs,data);element.append(e);if(fn){fn(e,data)}return e};var View=function(name,attrs,element,data,fn){if(attrs["kk:for"]){var evaluate=attrs["kk:for"];delete attrs["kk:for"];(function(evaluate){var indexKey="index";var itemKey="item";var evaluateScript=evaluate;var i=evaluate.indexOf(" in ");if(i>=0){itemKey=evaluate.substr(0,i);evaluateScript=evaluate.substr(i+4);i=itemKey.indexOf(",");if(i>=0){indexKey=itemKey.substr(0,i);itemKey=itemKey.substr(i+1)}}var be=new kk.Element;element.append(be);var elements=[];var datas=[];var app=kk.getApp();data.on(evaluateScript,function(value){kk.pushApp(app);var i=0;var item=function(idx,object){var e;var d;if(i<elements.length){e=elements[i];d=datas[i]}else{d=new kk.Data;e=ViewCreateWithName(name);ViewEachAttribute(e,attrs,d);be.before(e);if(fn){fn(e,d)}elements.push(e);datas.push(d);d.setParent(data)}d.set([indexKey],idx);d.set([itemKey],object);i++};if(value instanceof Array){for(var n=0;n<value.length;n++){item(n,value[n])}}else if(value instanceof Object){for(var key in value){item(key,value[key])}}while(i<elements.length){var e=elements.pop();var d=datas.pop();e.recycle();d.off()}kk.popApp()})})(evaluate)}else if(attrs["kk:if"]){var evaluate=attrs["kk:if"];delete attrs["kk:if"];(function(evaluate){var be=new kk.Element;element.append(be);var e;var d;var app=kk.getApp();data.on(evaluate,function(value){kk.pushApp(app);if(value){if(!e){d=new kk.Data;e=ViewCreateWithName(name);ViewEachAttribute(e,attrs,d);be.before(e);if(fn){fn(e,d)}d.setParent(data)}}else{if(e){d.recycle();e.remove();d=undefined;e=undefined}}kk.popApp()})})(evaluate)}else{ViewCreate(name,attrs,element,data,fn)}};kk.Page=function(app){this.app=app;this.data=new kk.Data({});this.appReflect=new kk.DataReflect(app.data)};kk.Page.prototype=kk.extend(Object.prototype,{createTitleView:function(){this.titleView=new kk.TextElement;this.titleView.setAttrs({font:"18px",color:"#000",layout:"relative",margin:"20px 0px 0px 0px"});this.topbar.append(this.titleView)},createLeftButton:function(){this.leftButton=new kk.ButtonElement;this.leftButton.setAttrs({height:"100%",left:"0px",padding:"20px 6px 0px 3px",hidden:"true"});this.topbar.append(this.leftButton);var v=new kk.TextElement;v.setAttrs({"#text":"返回",font:"16px",color:"#666",left:"4px"});v.appendTo(this.leftButton);var app=this.app;this.leftButton.on("tap",function(e){app.back(true)})},createTopbar:function(){this.topbar=new kk.ViewElement;this.topbar.setAttrs({width:"100%",top:"0px",height:"64px","background-color":"#fff",layout:"relative"});var v=new kk.ViewElement;v.setAttrs({width:"100%",height:"1px","background-color":"#a8e5e5e5",bottom:"0px"});v.appendTo(this.topbar);this.element.append(this.topbar);this.createTitleView();this.createLeftButton();var page=this;this.data.on(["page","title"],function(v){if(v!==undefined){kk.pushApp(page.app);page.titleView.set("#text",v+"");if(page.topbar.view){page.topbar.layoutChildren()}kk.popApp()}});this.data.on(["page","topbar","hidden"],function(v){if(v!==undefined){kk.pushApp(page.app);page.topbar.set("hidden",v?"true":"false");kk.popApp()}})},createElement:function(){this.element=new kk.ViewElement;this.element.setAttrs({width:"100%",height:"100%",padding:"-20px 0px 0px 0px"});return this.element},installTopbar:function(){if(!this.element){return}var element=this.element.firstChild;if(!element){return}element=element.firstChild;if(!element||element.get("#name")!="topbar"){return}var e=element.firstChild;while(e){var n=e.nextSibling;if(e instanceof kk.ViewElement){switch(e.get("target")){case"left":{if(this.leftView){continue}if(this.leftButton){this.leftButton.remove()}this.leftView=new kk.ViewElement;this.leftView.setAttrs({width:"25%",height:"100%",left:"0px",padding:"20px 0px 0px 3px"});this.leftView.appendTo(this.topbar);this.leftView.append(e)}break;case"center":{if(this.centerView){continue}if(this.titleView){this.titleView.remove()}this.centerView=new kk.ViewElement;this.centerView.setAttrs({width:"50%",height:"100%",padding:"20px 0px 0px 0px"});this.centerView.appendTo(this.topbar);this.centerView.append(e)}break;case"right":{if(this.rightView){continue}this.rightView=new kk.ViewElement;this.rightView.setAttrs({width:"25%",height:"100%",padding:"20px 3px 0px 0px",right:"0px"});this.rightView.appendTo(this.topbar);this.rightView.append(e)}break}}e=n}},open:function(path){var element=this.createElement();var data=this.data;var v=this.app.getScript(path+"_view.js");if(v){eval(v)}this.createTopbar();this.installTopbar();this.app.exec(path+".js",{page:this.data,app:this.appReflect})},recycle:function(){this.data.off();this.data.recycle();this.appReflect.off();this.appReflect.recycle()},setOrientation:function(width,height){switch(this.app.orientation){case"portrait":this.data.set(["page","orientation"],{landscape:false,portrait:true,landscapeLeft:false,landscapeRight:false});break;case"landscape":this.data.set(["page","orientation"],{landscape:true,portrait:false,landscapeLeft:true,landscapeRight:false});break;default:if(width>height){this.data.set(["page","orientation"],{landscape:true,portrait:false,landscapeLeft:true,landscapeRight:false})}else{this.data.set(["page","orientation"],{landscape:false,portrait:true,landscapeLeft:false,landscapeRight:false})}}},obtainView:function(view){var page=this;var app=this.app;if(this.fnDataChanged){this.data.off(["data"],this.fnDataChanged);delete this.fnDataChanged}this.data.set(["page","willAppear"],{});if(this.element instanceof kk.ViewElement){this.setOrientation(view.clientWidth,view.clientHeight);app.post(function(){page.element.layout(view.clientWidth,view.clientHeight);page.element.obtainView(view)})}this.fnDataChanged=function(value,keys){if(keys.length>0&&keys[0]=="data"){if(page.element instanceof kk.ViewElement){app.post(function(){page.element.layout(view.clientWidth,view.clientHeight);page.element.obtainView(view)})}}};this.data.on(["data"],this.fnDataChanged,true,1);this.data.set(["page","didAppear"],{})},recycleView:function(){this.data.set(["page","willDisappear"],{});if(this.element instanceof kk.ViewElement){this.element.recycleView()}this.data.set(["page","didDisappear"],{});if(this.fnDataChanged){this.data.off(["data"],this.fnDataChanged);delete this.fnDataChanged}},resize:function(width,height,view){if(this.element instanceof kk.ViewElement){this.element.onResize();this.setOrientation(width,height);var page=this;var app=this.app;app.post(function(){page.element.layout(width,height);if(view&&page.element instanceof kk.ViewElement){page.element.obtainView(view)}})}}})})();(function(){kk.Window=function(){kk.Page.apply(this,arguments)};kk.Window.prototype=kk.extend(kk.Page.prototype,{createTopbar:function(){},installTopbar:function(){},createElement:function(){this.element=new kk.BodyElement;this.element.setAttrs({width:"100%",height:"100%",padding:"-20px 0px 0px 0px"});return this.element}})})();